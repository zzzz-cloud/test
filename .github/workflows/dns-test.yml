name: DNS Lookup
on: [push, workflow_dispatch]  # 支持推送和手动触发

jobs:
  kdig-test:
    runs-on: ubuntu-latest
    steps:
      - name: Install kdig
        run: |
          sudo apt-get update
          sudo apt-get install -y knot-dnsutils

      # =========================
      # 🔹 传统 UDP/TCP DNS 查询
      # =========================
      - name: Google DNS (8.8.8.8)
        run: kdig @8.8.8.8 h5.gantanhao.com

      - name: Quad9 DNS (9.9.9.9)
        run: kdig @9.9.9.9 h5.gantanhao.com

      - name: OpenDNS (208.67.222.222)
        run: kdig @208.67.222.222 h5.gantanhao.com

      - name: AdGuard DNS (94.140.14.14)
        run: kdig @94.140.14.14 h5.gantanhao.com

      - name: Alibaba DNS (223.5.5.5)
        run: kdig @223.5.5.5 h5.gantanhao.com

      - name: DNSPod (119.29.29.29)
        run: kdig @119.29.29.29 h5.gantanhao.com

      # =========================
      # 🔹 DNS over TLS (DoT)
      # =========================
      - name: Cloudflare DNS over TLS (+tls)
        run: kdig @1.1.1.1 +tls h5.gantanhao.com

      - name: Cloudflare DNS over TLS (tls://)
        run: kdig tls://1.1.1.1 h5.gantanhao.com

      - name: Google DNS over TLS (+tls)
        run: kdig +tls @dns.google h5.gantanhao.com

      - name: Google DNS over TLS (tls://)
        run: kdig tls://dns.google h5.gantanhao.com

      - name: Quad9 DNS over TLS (+tls)
        run: kdig @9.9.9.9 +tls h5.gantanhao.com

      - name: Quad9 DNS over TLS (tls://)
        run: kdig tls://dns.quad9.net h5.gantanhao.com

      - name: AdGuard DNS over TLS (+tls)
        run: kdig @94.140.14.14 +tls h5.gantanhao.com

      - name: AdGuard DNS over TLS (tls://)
        run: kdig tls://unfiltered.adguard-dns.com h5.gantanhao.com

      # =========================
      # 🔹 DNS over HTTPS (DoH)
      # =========================
      - name: Cloudflare DoH
        run: kdig https://cloudflare-dns.com/dns-query h5.gantanhao.com

      - name: Google DoH
        run: kdig https://dns.google/dns-query h5.gantanhao.com

      - name: Google Doh-2
        run: kdig +https=https://dns.google/dns-query h5.gantanhao.com
      - name: Google Doh-3
        run: kdig @https://dns.google h5.gantanhao.com

      - name: Quad9 DoH
        run: kdig https://dns.quad9.net/dns-query h5.gantanhao.com

      - name: AdGuard DoH
        run: kdig https://unfiltered.adguard-dns.com/dns-query h5.gantanhao.com
